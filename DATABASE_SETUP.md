# üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

## –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:** `ptsr_expert`

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è.

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ psql (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É PostgreSQL —Å–µ—Ä–≤–µ—Ä—É
psql -h your-server-host -U your-username -d postgres

# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE ptsr_expert;

# –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CREATE USER ptsr_user WITH ENCRYPTED PASSWORD 'secure_password_123';

# –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
GRANT ALL PRIVILEGES ON DATABASE ptsr_expert TO ptsr_user;

# –í—ã–π–¥–∏—Ç–µ
\q
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ pgAdmin –∏–ª–∏ –¥—Ä—É–≥–æ–π GUI

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É
3. –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ "Databases" ‚Üí "Create" ‚Üí "Database"
4. –ò–º—è: `ptsr_expert`
5. Owner: –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
6. –ù–∞–∂–º–∏—Ç–µ "Save"

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å

```sql
CREATE DATABASE ptsr_expert
    WITH 
    OWNER = your_username
    ENCODING = 'UTF8'
    LC_COLLATE = 'ru_RU.UTF-8'
    LC_CTYPE = 'ru_RU.UTF-8'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;
```

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –§–æ—Ä–º–∞—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
# postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE_NAME?schema=public

DATABASE_URL="postgresql://ptsr_user:secure_password_123@your-server-host:5432/ptsr_expert?schema=public"

# –î–ª—è NextAuth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="generate-this-with-openssl-rand-base64-32"
```

### –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:

**–õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL:**
```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/ptsr_expert?schema=public"
```

**–£–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:**
```env
DATABASE_URL="postgresql://ptsr_user:MySecurePass123@192.168.1.100:5432/ptsr_expert?schema=public"
```

**–° SSL:**
```env
DATABASE_URL="postgresql://user:pass@host:5432/ptsr_expert?schema=public&sslmode=require"
```

## –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DATABASE_URL –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Å—Ö–µ–º—É –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
npx prisma db push

# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev --name init
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ Prisma Studio –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ë–î
npx prisma studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ http://localhost:5555

## –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã:

1. **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
   - –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (email, –ø–∞—Ä–æ–ª—å, –∏–º—è)
   - –†–æ–ª–∏ (admin, support, psychologist, volunteer, user)
   - –ü—Ä–æ—Ñ–∏–ª—å (—Ç–µ–ª–µ—Ñ–æ–Ω, –∞–≤–∞—Ç–∞—Ä, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, –ø–æ–ª, –≥–æ—Ä–æ–¥)

2. **accounts** - –ê–∫–∫–∞—É–Ω—Ç—ã NextAuth (–¥–ª—è OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)

3. **sessions** - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. **verification_tokens** - –¢–æ–∫–µ–Ω—ã –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email

5. **mood_entries** - –ó–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
   - –£—Ä–æ–≤–µ–Ω—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (1-5)
   - –¢–∏–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
   - –ó–∞–º–µ—Ç–∫–∏

6. **diary_entries** - –ó–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
   - –¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

7. **support_tickets** - –¢–∏–∫–µ—Ç—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - –¢–µ–º–∞, —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –°—Ç–∞—Ç—É—Å, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
   - –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫

8. **psychologist_profiles** - –ü—Ä–æ—Ñ–∏–ª–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –æ–ø—ã—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
   - –¶–µ–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
   - –†–µ–π—Ç–∏–Ω–≥, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

9. **articles** - –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫, —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, slug
   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è, —Ç–µ–≥–∏
   - –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

10. **videos** - –í–∏–¥–µ–æ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    - –ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, URL
    - –ö–∞—Ç–µ–≥–æ—Ä–∏—è, —Ç–µ–≥–∏
    - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

11. **courses** - –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    - –ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω–∞
    - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—Ä–æ–≤–µ–Ω—å

12. **course_modules** - –ú–æ–¥—É–ª–∏ –∫—É—Ä—Å–æ–≤
    - –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π
    - –ü–æ—Ä—è–¥–æ–∫

13. **course_enrollments** - –ó–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫—É—Ä—Å—ã
    - –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
    - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

14. **transactions** - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    - –ü–ª–∞—Ç–µ–∂–∏, –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è
    - –°—Ç–∞—Ç—É—Å, —Å—É–º–º–∞

## –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ß–µ—Ä–µ–∑ SQL:

```sql
-- –•–µ—à –ø–∞—Ä–æ–ª—è 'admin123' (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ bcryptjs)
INSERT INTO users (
  id, 
  email, 
  password, 
  full_name, 
  roles, 
  created_at, 
  updated_at
) VALUES (
  gen_random_uuid(),
  'admin@ptsr-expert.ru',
  '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5lXnvZJm.Qa0S',
  '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
  ARRAY['ADMIN']::user_role[],
  NOW(),
  NOW()
);
```

### –ß–µ—Ä–µ–∑ Node.js —Å–∫—Ä–∏–ø—Ç:

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `scripts/seed-admin.js`:

```javascript
const { PrismaClient } = require('@prisma/client')
const bcrypt = require('bcryptjs')

const prisma = new PrismaClient()

async function main() {
  const hashedPassword = await bcrypt.hash('admin123', 12)
  
  const admin = await prisma.user.create({
    data: {
      email: 'admin@ptsr-expert.ru',
      password: hashedPassword,
      fullName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
      roles: ['ADMIN'],
    },
  })

  console.log('‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω:', admin.email)
}

main()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
node scripts/seed-admin.js
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ PostgreSQL

- **–í–µ—Ä—Å–∏—è**: PostgreSQL 12 –∏–ª–∏ –≤—ã—à–µ
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è**: –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∞–≤–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ PostgreSQL

```sql
SELECT version();
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: PostgreSQL 12.x –∏–ª–∏ –≤—ã—à–µ

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö?

–î–∞! –ü—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏—Ç–µ –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ DATABASE_URL. Prisma —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏.

### –ù—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤—Ä—É—á–Ω—É—é?

–ù–µ—Ç! Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `npx prisma db push`.

### –ß—Ç–æ –µ—Å–ª–∏ —è —Ö–æ—á—É –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ø–æ–∑–∂–µ?

1. –ò–∑–º–µ–Ω–∏—Ç–µ `prisma/schema.prisma`
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `npx prisma migrate dev --name –Ω–∞–∑–≤–∞–Ω–∏–µ_–∏–∑–º–µ–Ω–µ–Ω–∏—è`
3. Prisma —Å–æ–∑–¥–∞—Å—Ç –º–∏–≥—Ä–∞—Ü–∏—é –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –µ—ë

### –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ?

```bash
npx prisma studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

### –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö?

```bash
pg_dump -h your-host -U your-user -d ptsr_expert > backup.sql
```

### –ö–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞?

```bash
psql -h your-host -U your-user -d ptsr_expert < backup.sql
```

## –ì–æ—Ç–æ–≤–æ! üéâ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –≤–∞—à–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å `npm run dev` –∏ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.



