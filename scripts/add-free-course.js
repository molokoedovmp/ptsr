const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function main() {
  console.log('Добавляем бесплатный курс...')

  // Находим админа
  const admin = await prisma.user.findFirst({
    where: {
      roles: {
        has: 'ADMIN',
      },
    },
  })

  if (!admin) {
    console.error('Администратор не найден')
    return
  }

  // Создаём бесплатный курс
  const course = await prisma.course.create({
    data: {
      title: 'Основы самопомощи при ПТСР',
      slug: 'osnovy-samopomoshchi-pri-ptsr',
      description: 'Бесплатный вводный курс по основам самопомощи и управления симптомами ПТСР',
      fullDescription: `Этот курс разработан специально для тех, кто столкнулся с посттравматическим стрессовым расстройством и хочет научиться справляться с его симптомами.

Вы узнаете:
• Что такое ПТСР и как оно влияет на вашу жизнь
• Техники управления тревогой и стрессом  
• Методы заземления и возвращения в настоящий момент
• Способы улучшения сна и повседневного функционирования
• Как создать безопасное пространство для восстановления

Этот курс полностью бесплатный и доступен сразу после регистрации.`,
      price: 0,
      durationWeeks: 4,
      level: 'Начальный',
      published: true,
      coverImage: null,
    },
  })

  console.log(`Курс "${course.title}" создан с ID: ${course.id}`)

  // Добавляем модули
  const modules = [
    {
      title: 'Понимание ПТСР',
      description: 'Узнайте, что такое ПТСР, его симптомы и влияние на жизнь',
      content: `В этом модуле вы узнаете:

- Определение посттравматического стрессового расстройства
- Основные симптомы: навязчивые воспоминания, избегание, негативные изменения мышления и настроения, изменения физических и эмоциональных реакций
- Как ПТСР влияет на мозг и тело
- Распространённые мифы о ПТСР
- Важность обращения за профессиональной помощью

Понимание того, что с вами происходит - первый шаг к восстановлению.`,
      orderIndex: 0,
    },
    {
      title: 'Техники заземления',
      description: 'Освойте практические методы возвращения в настоящий момент',
      content: `Техники заземления помогают вернуться в настоящее, когда вас захлёстывают воспоминания или тревога.

Основные техники:
- Техника 5-4-3-2-1 (использование пяти чувств)
- Осознанное дыхание
- Физическое заземление
- Использование холодной воды
- Называние эмоций

Практикуйте эти техники ежедневно, чтобы они стали автоматическими в моменты стресса.`,
      orderIndex: 1,
    },
    {
      title: 'Управление тревогой',
      description: 'Изучите стратегии снижения тревожности в повседневной жизни',
      content: `Тревога - один из основных симптомов ПТСР. В этом модуле вы научитесь:

- Распознавать ранние признаки тревоги
- Использовать дыхательные упражнения
- Применять прогрессивную мышечную релаксацию
- Создавать безопасное пространство
- Использовать позитивную визуализацию
- Вести дневник тревоги

Помните: тревога временна, и у вас есть инструменты для её преодоления.`,
      orderIndex: 2,
    },
    {
      title: 'Улучшение качества сна',
      description: 'Научитесь справляться с нарушениями сна и кошмарами',
      content: `Проблемы со сном часто сопровождают ПТСР. Этот модуль поможет вам:

- Создать здоровый режим сна
- Подготовить комфортную среду для отдыха
- Справиться с ночными кошмарами
- Использовать техники релаксации перед сном
- Понять, когда нужна дополнительная помощь

Качественный сон критически важен для восстановления и эмоциональной регуляции.`,
      orderIndex: 3,
    },
    {
      title: 'Построение системы поддержки',
      description: 'Узнайте, как создать сеть поддержки для вашего восстановления',
      content: `Восстановление не происходит в изоляции. В этом модуле:

- Определите людей, которым вы доверяете
- Научитесь просить о помощи
- Найдите группы поддержки
- Установите здоровые границы
- Общайтесь о своих потребностях

Ваша система поддержки - это ключевой ресурс на пути к исцелению.`,
      orderIndex: 4,
    },
  ]

  for (const moduleData of modules) {
    await prisma.courseModule.create({
      data: {
        ...moduleData,
        courseId: course.id,
      },
    })
  }

  console.log(`Добавлено ${modules.length} модулей`)
  console.log('Готово!')
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })

